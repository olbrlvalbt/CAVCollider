#include "pch.h"

#include "NaiveController.h"
#include "GliderMap.h"

#include <string>
#include <wx/wx.h>
#include <wx/dcgraph.h>
#include <wx/progdlg.h>

#include <iostream>
#include <fstream>

#include "CollisionSystem.h"
#include "Rule110.h"

using namespace std;

void filterT3(int cellsize, NaiveController* eca, wxGCDC& filterDc, string iterationGroup[4], int iteration, int minPaintCell = 0, int maxPaintCell = -1) {
	maxPaintCell = maxPaintCell == -1 ? eca->getN() : maxPaintCell;

	string f1 = "";
	string f2 = "";
	string f3 = "";
	string f4 = "";

	int n = eca->getN();

	for (int i = 0; i < n; i++) {
		f1 = iterationGroup[0].at(i);
		f1 += iterationGroup[0].at((i + 1) % n);
		f1 += iterationGroup[0].at((i + 2) % n);
		f1 += iterationGroup[0].at((i + 3) % n);

		f2 = iterationGroup[1].at(i);
		f2 += iterationGroup[1].at((i + 1) % n);
		f2 += iterationGroup[1].at((i + 2) % n);
		f2 += iterationGroup[1].at((i + 3) % n);

		f3 = iterationGroup[2].at(i);
		f3 += iterationGroup[2].at((i + 1) % n);
		f3 += iterationGroup[2].at((i + 2) % n);
		f3 += iterationGroup[2].at((i + 3) % n);

		f4 = iterationGroup[3].at(i);
		f4 += iterationGroup[3].at((i + 1) % n);

		if(i >= minPaintCell && i < maxPaintCell) {
			if (f1.compare("1111") == 0 && f2.compare("1000") == 0 && f3.compare("1001") == 0 && f4.compare("10") == 0) {
				filterDc.SetBrush(wxBrush(wxColour(230, 230, 230)));
				filterDc.DrawRectangle((i - minPaintCell) * cellsize, iteration * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 1) % n) * cellsize, iteration * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 2) % n) * cellsize, iteration * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 3) % n) * cellsize, iteration * cellsize, cellsize, cellsize);

				filterDc.DrawRectangle((i - minPaintCell) * cellsize, (iteration + 1) * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 1) % n) * cellsize, (iteration + 1) * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 2) % n) * cellsize, (iteration + 1) * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 3) % n) * cellsize, (iteration + 1) * cellsize, cellsize, cellsize);

				filterDc.DrawRectangle((i - minPaintCell) * cellsize, (iteration + 2) * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 1) % n) * cellsize, (iteration + 2) * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 2) % n) * cellsize, (iteration + 2) * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 3) % n) * cellsize, (iteration + 2) * cellsize, cellsize, cellsize);

				filterDc.DrawRectangle((i - minPaintCell) * cellsize, (iteration + 3) * cellsize, cellsize, cellsize);
				filterDc.DrawRectangle((((i - minPaintCell) + 1) % n) * cellsize, (iteration + 3) * cellsize, cellsize, cellsize);
			}
		}
	}
}

void createCollision(string ic, int n = 1000, int cellsize = 5, string path = "", int offset = 0, int minPaintCell = 0, int maxPaintCell = -1) {
	maxPaintCell = maxPaintCell == -1 ? ic.length() : maxPaintCell;
	int paintMargin = maxPaintCell - minPaintCell;
	
	wxInitAllImageHandlers();
	
	wxBrush deadCellBrush = wxBrush(wxColour(220, 170, 15));
	wxBrush aliveCellBrush = wxBrush(wxColour(115, 35, 15));
	
	NaiveController* eca = new NaiveController(ic.length(), 110, ic);

	for (int i = 0; i < offset; i++) {
		eca->applyRule();
	}

	wxBitmap* bitmap = new wxBitmap(paintMargin * cellsize, n * cellsize);
	wxMemoryDC baseDc(*bitmap);
	baseDc.SetPen(wxPen(wxColor(0, 0, 0), 1, wxPENSTYLE_TRANSPARENT));


	wxBitmap* filterBitmap = new wxBitmap(paintMargin * cellsize, n * cellsize, 32);
	filterBitmap->UseAlpha();
	wxMemoryDC filterMemDc(*filterBitmap);

	wxGCDC filterDc(filterMemDc);
	filterDc.SetBackground(*wxTRANSPARENT_BRUSH);
	filterDc.Clear();
	filterDc.SetPen(*wxTRANSPARENT_PEN);

	string iterationGroup[4] = { "", "", "", "" };


	int k = 0;
	int j = 0;

	for (; j < 4; j++) {
		for (int i = minPaintCell; i < maxPaintCell; i++) {
			if (eca->getCurrentState()[0].at(i) == '1') {
				baseDc.SetBrush(aliveCellBrush);
			}
			else {
				baseDc.SetBrush(deadCellBrush);
			}
			baseDc.DrawRectangle((i - minPaintCell) * cellsize, j * cellsize, cellsize, cellsize);
		}

		iterationGroup[j] = eca->getCurrentState()[0];
		eca->applyRule();
	}

	for (; j < n; j++) {
		filterT3(cellsize, eca, filterDc, iterationGroup, j - 4, minPaintCell, maxPaintCell);

		
		iterationGroup[0] = iterationGroup[1];
		iterationGroup[1] = iterationGroup[2];
		iterationGroup[2] = iterationGroup[3];
		iterationGroup[3] = eca->getCurrentState()[0];

		for (int i = minPaintCell; i < maxPaintCell; i++) {
			if (eca->getCurrentState()[0].at(i) == '1') {
				baseDc.SetBrush(aliveCellBrush);
			}
			else {
				baseDc.SetBrush(deadCellBrush);
			}
			baseDc.DrawRectangle((i - minPaintCell) * cellsize, j * cellsize, cellsize, cellsize);
		}

		eca->applyRule();
	}

	filterT3(cellsize, eca, filterDc, iterationGroup, j - 4, minPaintCell, maxPaintCell);

	baseDc.SelectObject(wxNullBitmap);
	filterMemDc.SelectObject(wxNullBitmap);
	

	wxFileDialog saveFileDialog(NULL, _("Save file"), wxGetCwd(), "",
		"PNG files (*.png)|*.png", wxFD_SAVE | wxFD_OVERWRITE_PROMPT);

	if (path.empty()) {
		if (saveFileDialog.ShowModal() == wxID_CANCEL) {
			return;
		}
	}
	
	wxBitmap* screenshot = new wxBitmap(paintMargin * cellsize, n * cellsize);

	wxMemoryDC memDC(*screenshot);

	wxMemoryDC baseSSDc(*bitmap);
	memDC.Blit(0, //Copy to this X coordinate
		0, //Copy to this Y coordinate
		paintMargin * cellsize, //Copy this width
		n * cellsize, //Copy this height
		&baseSSDc, //From where do we copy?
		0, //What's the X offset in the original DC?
		0  //What's the Y offset in the original DC?
	);
	baseSSDc.SelectObject(wxNullBitmap);

	wxMemoryDC filterSSDc(*filterBitmap);
	memDC.Blit(0, //Copy to this X coordinate
		0, //Copy to this Y coordinate
		paintMargin * cellsize, //Copy this width
		n * cellsize, //Copy this height
		&filterSSDc, //From where do we copy?
		0, //What's the X offset in the original DC?
		0  //What's the Y offset in the original DC?
	);
	filterSSDc.SelectObject(wxNullBitmap);

	memDC.SelectObject(wxNullBitmap);

	if (path.empty()) {
		screenshot->SaveFile(saveFileDialog.GetPath(), wxBITMAP_TYPE_PNG);
	}
	else {
		screenshot->SaveFile(path, wxBITMAP_TYPE_PNG);
	}
	delete screenshot;

	delete bitmap;
	delete filterBitmap;
}

string printGrid(string ic, int n, int& globalI, ofstream& file, int phaseEscape, int cellsize, string path = "") {
	NaiveController* eca = new NaiveController(ic.length(), 110, ic);

	wxBrush deadCellBrush = wxBrush(wxColour(5, 5, 5));
	wxBrush aliveCellBrush = wxBrush(wxColour(0, 0, 0));
	
	wxBitmap* bitmap = new wxBitmap(eca->getN() * cellsize, n * cellsize);
	wxMemoryDC baseDc(*bitmap);
	baseDc.SetPen(wxPen(wxColor(0, 0, 0), 1, wxPENSTYLE_TRANSPARENT));


	wxBitmap* filterBitmap = new wxBitmap(eca->getN() * cellsize, n * cellsize, 32);
	filterBitmap->UseAlpha();
	wxMemoryDC filterMemDc(*filterBitmap);

	wxGCDC filterDc(filterMemDc);
	filterDc.SetBackground(*wxTRANSPARENT_BRUSH);
	filterDc.Clear();
	filterDc.SetPen(*wxTRANSPARENT_PEN);

	string iterationGroup[4] = { "", "", "", "" };


	int k = 0;
	int j = 0;

	for (; j < 4; j++, globalI++) {
		if (globalI % n == 0) {
			file << endl;
			file << "Iteration " << std::to_string(globalI) << endl;
			string cur = eca->getCurrentState()[0];
			for (int trimI = 0; trimI < cur.length(); trimI += phaseEscape) {
				file << cur.substr(trimI, phaseEscape) << endl;
			}
		}
		for (int i = 0; i < eca->getN(); i++) {
			if (eca->getCurrentState()[0].at(i) == '1') {
				baseDc.SetBrush(aliveCellBrush);
			}
			else {
				baseDc.SetBrush(deadCellBrush);
			}
			baseDc.DrawRectangle((i - 0) * cellsize, j * cellsize, cellsize, cellsize);
		}

		iterationGroup[j] = eca->getCurrentState()[0];
		eca->applyRule();
	}

	for (; j < n; j++, globalI++) {
		if (globalI % n == 0) {
			file << endl;
			file << "Iteration " << std::to_string(globalI) << endl;
			string cur = eca->getCurrentState()[0];
			for (int trimI = 0; trimI < cur.length(); trimI += phaseEscape) {
				file << cur.substr(trimI, phaseEscape) << endl;
			}
		}
		filterT3(cellsize, eca, filterDc, iterationGroup, j - 4, 0, eca->getN());


		iterationGroup[0] = iterationGroup[1];
		iterationGroup[1] = iterationGroup[2];
		iterationGroup[2] = iterationGroup[3];
		iterationGroup[3] = eca->getCurrentState()[0];

		for (int i = 0; i < eca->getN(); i++) {
			if (eca->getCurrentState()[0].at(i) == '1') {
				baseDc.SetBrush(aliveCellBrush);
			}
			else {
				baseDc.SetBrush(deadCellBrush);
			}
			baseDc.DrawRectangle((i - 0) * cellsize, j * cellsize, cellsize, cellsize);
		}

		eca->applyRule();
	}

	filterT3(cellsize, eca, filterDc, iterationGroup, j - 4, 0, eca->getN());

	baseDc.SelectObject(wxNullBitmap);
	filterMemDc.SelectObject(wxNullBitmap);


	wxFileDialog saveFileDialog(NULL, _("Save file"), wxGetCwd(), "",
		"PNG files (*.png)|*.png", wxFD_SAVE | wxFD_OVERWRITE_PROMPT);

	if (path.empty()) {
		if (saveFileDialog.ShowModal() == wxID_CANCEL) {
			throw exception("waaa");
		}
	}

	wxBitmap* screenshot = new wxBitmap(eca->getN() * cellsize, n * cellsize);

	wxMemoryDC memDC(*screenshot);

	wxMemoryDC baseSSDc(*bitmap);
	memDC.Blit(0, //Copy to this X coordinate
		0, //Copy to this Y coordinate
		eca->getN() * cellsize, //Copy this width
		n * cellsize, //Copy this height
		&baseSSDc, //From where do we copy?
		0, //What's the X offset in the original DC?
		0  //What's the Y offset in the original DC?
	);
	baseSSDc.SelectObject(wxNullBitmap);

	wxMemoryDC filterSSDc(*filterBitmap);
	memDC.Blit(0, //Copy to this X coordinate
		0, //Copy to this Y coordinate
		eca->getN() * cellsize, //Copy this width
		n * cellsize, //Copy this height
		&filterSSDc, //From where do we copy?
		0, //What's the X offset in the original DC?
		0  //What's the Y offset in the original DC?
	);
	filterSSDc.SelectObject(wxNullBitmap);

	memDC.SelectObject(wxNullBitmap);

	if (path.empty()) {
		screenshot->SaveFile(saveFileDialog.GetPath(), wxBITMAP_TYPE_PNG);
	}
	else {
		screenshot->SaveFile(path, wxBITMAP_TYPE_PNG);
	}
	delete screenshot;

	delete bitmap;
	delete filterBitmap;

	string currentState = eca->getCurrentState()[0];
	delete eca;

	return currentState;
}

void createGrid(string ic, int n = 1000, int maxGridSize = 1000, int cellsize = 5, string path = "", int offset = 0) {
	wxInitAllImageHandlers();

	wxBrush deadCellBrush = wxBrush(wxColour(5, 5, 5));
	wxBrush aliveCellBrush = wxBrush(wxColour(0, 0, 0));

	NaiveController* eca = new NaiveController(ic.length(), 110, ic);

	ofstream file(path + "phases.txt");
	int phaseEscape = 200;

	file << "Phases every " << std::to_string(n) << " iterations" << endl;
	
	int i;
	int globalI;
	for (i = 0, globalI = 0; i < offset; i++, globalI++) {
		if (globalI % n == 0) {
			file << endl;
			file << "Iteration " << std::to_string(globalI) << endl;
			string cur = eca->getCurrentState()[0];
			for (int trimI = 0; trimI < cur.length(); trimI += phaseEscape) {
				file << cur.substr(trimI, phaseEscape) << endl;
			}
		}
		
		eca->applyRule();
	}
	string currentState = eca->getCurrentState()[0];

	for (; i < maxGridSize; i += n) {
		currentState = printGrid(currentState, n, globalI, file,phaseEscape, cellsize, path + "iter" + std::to_string(i) + ".png");
	}
}

TEST(CreateCollisionsA_Eb, A_Eb) {
	int leftEthers = 2;
	int midEthers = 0;
	int rightEthers = 2;
	const string ether = "11111000100110";

	string leftEthersString = "";
	string midEthersString = "";
	string rightEthersString = "";

	int i, j, k, l;

	for (i = 0; i < leftEthers; i++) {
		leftEthersString += ether;
	}
	for (i = 0; i < midEthers; i++) {
		midEthersString += ether;
	}
	for (i = 0; i < rightEthers; i++) {
		rightEthersString += ether;
	}
	GliderMap gm = GliderMap();

	//string gliderA = gm.get("A", "A", 1);
	//string gliderEb = gm.get("E_", "A", 1);
	
	for (i = 0; i < 1; i++) {
		for (j = 0; j < 4; j++) {
			for (k = 0; k < 8; k++) {
				for (l = 0; l < 4; l++) {
					string controllerIC = leftEthersString + gm.getByIndex("A", i, j) + midEthersString + gm.getByIndex("Eb", k, l)  + rightEthersString;
					string path = "C:/Users/olbrl/Desktop/ECA1D/ParticleEnciclopedia/Collisions/A_Eb/A-" + to_string(i) + "-" + to_string(j) + "_Eb-" + to_string(k) + "-" + to_string(l) + ".png";
					createCollision(controllerIC, 100, 10, path);
				}
			}
		}
	}
	
	EXPECT_EQ(1, 1);
}

TEST(TestCTS10, Testing) {
	int minEthers = 12;
	int maxEthers = 100;

	int offset = 0;
	int numIterations = 3000;

	Rule110 r;

	string left = r.Translate("2e");

	string right = r.Translate("1Ele_C2(A, f1_1) - A3(A, f1_1) - SepInit_EE_(C, f3_1) - 1BloP_E_(C, f4_1)");

	vector<string> g0elec2 = {
		"1111100000010011011111000100110111110001001101111100000010011011111000100110111000110001001101111100010011011111000100000110"
		,
			"1111100010000011011111000100110111110001001101111100010000011011111000100110111110100111001101111100010011011111000100110000"
		,
			"0001111100010011011111000100110111110001001100001111100010011011111000111011010111110001001101111100010011011100011000100110"
		,
			"1110001100010011011111000100110111110001001101110001100010011011111000100110111111110001001101111100010011011111010011100110"

		,
			"1111101001110011011111000100110111110001001101111101001110011011111000100110111110000001001101111100010011011111000111011010"
		,
			"1111100011101101011111000100110111110001001101111100011101101011111000100110111110001000001101111100010011011111000100110111"
		,
			"1111111100010011011111000100110111110001001101111111100010011011111000100110000111110001001101111100010011011111000000100110"
	};
	
	string basePath = "D:/olbrl/Downloads/CollisionTest/";
	
	for (int i = minEthers; i < maxEthers; i++) {
		for (int j = 0; j < g0elec2.size(); j++) {
			cout << "Starting " + std::to_string(i) + "e_f" + std::to_string(j) << endl;
			string cur = to_string(i) + "e";
			string ic = left + g0elec2[j] + r.Translate(cur) + right;

			createCollision(ic, numIterations, 1, 
				basePath + "g_" + std::to_string(i) + "e_f" + std::to_string(j) + ".png",
				500);
		}
	}

	EXPECT_EQ(1, 1);
}


TEST(TestCTS10Dephased, Testing) {
	int offset = 12;
	int maxDephase = 200;
	int numIterations = 3000;

	int midEthers = 5;
	

	Rule110 r;

	string left = r.Translate("2e");
	
	string mid = r.Translate(std::to_string(midEthers) + "e");

	string right = r.Translate("e - 1Ele_C2(A, f1_1) - A3(A, f1_1) - SepInit_EE_(C, f3_1) - 1BloP_E_(C, f4_1)");

	NaiveController* dephasedEca = new NaiveController(right.length(), 110, right);
	for (int i = 0; i < offset; i++) {
		dephasedEca->applyRule();
	}

	vector<string> g0elec2 = {
		"1111100000010011011111000100110111110001001101111100000010011011111000100110111000110001001101111100010011011111000100000110"
		,
			"1111100010000011011111000100110111110001001101111100010000011011111000100110111110100111001101111100010011011111000100110000"
		,
			"0001111100010011011111000100110111110001001100001111100010011011111000111011010111110001001101111100010011011100011000100110"
		,
			"1110001100010011011111000100110111110001001101110001100010011011111000100110111111110001001101111100010011011111010011100110"

		,
			"1111101001110011011111000100110111110001001101111101001110011011111000100110111110000001001101111100010011011111000111011010"
		,
			"1111100011101101011111000100110111110001001101111100011101101011111000100110111110001000001101111100010011011111000100110111"
		,
			"1111111100010011011111000100110111110001001101111111100010011011111000100110000111110001001101111100010011011111000000100110"
	};

	vector<string> leftEthers = {
		"",
		"1111",
		"11111000",
		"111110001001",
		"11",
		"111110",
		"1111100010"
	};

	vector<string> rightEthers = {
		"",
		"1000100110",
		"100110",
		"10",
		"111000100110",
		"00100110",
		"0110"
	};
	
	string basePath = "D:/olbrl/Downloads/CollisionDephased/";

	for (int i = offset; i < maxDephase; i++) {
		for (int j = 0; j < g0elec2.size(); j++) {
			string ic = left + g0elec2[j] + mid + leftEthers[i % 7] + dephasedEca->getCurrentState()[0] + rightEthers[i % 7];

			createCollision(ic, numIterations, 1,
				basePath + "g_p" + std::to_string(i) + "_f" + std::to_string(j) + ".png",
				0);
		}

		dephasedEca->applyRule();
	}

	EXPECT_EQ(1, 1);
}

TEST(TestCTS11, Testing) {
	int minEthers = 5;
	int maxEthers = 100;

	int offset = 0;
	int numIterations = 3000;

	Rule110 r;

	string left = r.Translate("2e");

	string right = r.Translate("1Ele_C2(A, f1_1) - A3(A, f1_1) - SepInit_EE_(C, f3_1) - 1BloP_E_(C, f4_1)");

	vector<string> g1elec2 = {
		"111110000001001101111100010011011111000100110111110000001001101111100010011011111000100110111110000001001101111100010011011111000111011010"
		,
			"111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111"
		,
			"000111110001001101111100010011011111000100110000111110001001101111100010011011111000100110000111110001001101111100010011011111000000100110"
		,
			"111000110001001101111100010011011111000100110111000110001001101111100010011011111000100110111000110001001101111100010011011111000100000110"

		,
			"111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110000"
		,
			"11111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011100011000100110"
		,
			"111111110001001101111100010011011111000100110111111110001001101111100010011011111000100110111111110001001101111100010011011111010011100110"
	};

	string basePath = "D:/olbrl/Downloads/Collisions11/";

	for (int i = minEthers; i < maxEthers; i++) {
		for (int j = 0; j < g1elec2.size(); j++) {
			cout << "Starting " + std::to_string(i) + "e_f" + std::to_string(j) << endl;
			string cur = to_string(i) + "e";
			string ic = left + g1elec2[j] + r.Translate(cur) + right;

			createCollision(ic, numIterations, 1,
				basePath + "g_" + std::to_string(i) + "e_f" + std::to_string(j) + ".png",
				500);
		}
	}

	EXPECT_EQ(1, 1);
}


TEST(TestCTS11Dephased, Testing) {
	int offset = 0;
	int maxDephase = 200;
	int numIterations = 3000;

	int midEthers = 5;


	Rule110 r;

	string left = r.Translate("2e");

	string mid = r.Translate(std::to_string(midEthers) + "e");

	string right = r.Translate("e - 1Ele_C2(A, f1_1) - A3(A, f1_1) - SepInit_EE_(C, f3_1) - 1BloP_E_(C, f4_1)");

	NaiveController* dephasedEca = new NaiveController(right.length(), 110, right);
	for (int i = 0; i < offset; i++) {
		dephasedEca->applyRule();
	}

	vector<string> g1elec2 = {
		"111110000001001101111100010011011111000100110111110000001001101111100010011011111000100110111110000001001101111100010011011111000111011010"
		,
			"111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111"
		,
			"000111110001001101111100010011011111000100110000111110001001101111100010011011111000100110000111110001001101111100010011011111000000100110"
		,
			"111000110001001101111100010011011111000100110111000110001001101111100010011011111000100110111000110001001101111100010011011111000100000110"

		,
			"111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110000"
		,
			"11111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011100011000100110"
		,
			"111111110001001101111100010011011111000100110111111110001001101111100010011011111000100110111111110001001101111100010011011111010011100110"
	};

	vector<string> leftEthers = {
		"",
		"1111",
		"11111000",
		"111110001001",
		"11",
		"111110",
		"1111100010"
	};

	vector<string> rightEthers = {
		"",
		"1000100110",
		"100110",
		"10",
		"111000100110",
		"00100110",
		"0110"
	};

	string basePath = "D:/olbrl/Downloads/Collisions11Dephased/";

	for (int i = offset; i < maxDephase; i++) {
		for (int j = 0; j < g1elec2.size(); j++) {
			string ic = left + g1elec2[j] + mid + leftEthers[i % 7] + dephasedEca->getCurrentState()[0] + rightEthers[i % 7];

			createCollision(ic, numIterations, 1,
				basePath + "g_p" + std::to_string(i) + "_f" + std::to_string(j) + ".png",
				0);
		}

		dephasedEca->applyRule();
	}

	EXPECT_EQ(1, 1);
}

TEST(TestCTS01, Testing) {
	int minEthers = 4;
	int maxEthers = 100;

	int offset = 0;
	int numIterations = 3000;

	Rule110 r;

	string left = r.Translate("2e");

	string right = r.Translate("0Ele_C2(A, f3_1) - A3(A, f1_1) - SepInit_EE_(C, f3_1) - 1BloP_E_(C, f4_1)");

	vector<string> g1elec2 = {
		"111110000001001101111100010011011111000100110111110000001001101111100010011011111000100110111110000001001101111100010011011111000111011010"
		,
			"111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111"
		,
			"000111110001001101111100010011011111000100110000111110001001101111100010011011111000100110000111110001001101111100010011011111000000100110"
		,
			"111000110001001101111100010011011111000100110111000110001001101111100010011011111000100110111000110001001101111100010011011111000100000110"

		,
			"111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110000"
		,
			"11111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011100011000100110"
		,
			"111111110001001101111100010011011111000100110111111110001001101111100010011011111000100110111111110001001101111100010011011111010011100110"
	};

	string basePath = "D:/olbrl/Downloads/Collisions01/";

	for (int i = minEthers; i < maxEthers; i++) {
		for (int j = 0; j < g1elec2.size(); j++) {
			cout << "Starting " + std::to_string(i) + "e_f" + std::to_string(j) << endl;
			string cur = to_string(i) + "e";
			string ic = left + g1elec2[j] + r.Translate(cur) + right;

			createCollision(ic, numIterations, 1,
				basePath + "g_" + std::to_string(i) + "e_f" + std::to_string(j) + ".png",
				offset);
		}
	}

	EXPECT_EQ(1, 1);
}


TEST(TestCTS01Dephased, Testing) {
	int offset = 0;
	int maxDephase = 200;
	int numIterations = 3000;

	int midEthers = 5;


	Rule110 r;

	string left = r.Translate("2e");

	string mid = r.Translate(std::to_string(midEthers) + "e");

	string right = r.Translate("e - 0Ele_C2(A, f3_1) - A3(A, f1_1) - SepInit_EE_(C, f3_1) - 1BloP_E_(C, f4_1)");

	NaiveController* dephasedEca = new NaiveController(right.length(), 110, right);
	for (int i = 0; i < offset; i++) {
		dephasedEca->applyRule();
	}

	vector<string> g1elec2 = {
		"111110000001001101111100010011011111000100110111110000001001101111100010011011111000100110111110000001001101111100010011011111000111011010"
		,
			"111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111"
		,
			"000111110001001101111100010011011111000100110000111110001001101111100010011011111000100110000111110001001101111100010011011111000000100110"
		,
			"111000110001001101111100010011011111000100110111000110001001101111100010011011111000100110111000110001001101111100010011011111000100000110"

		,
			"111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110000"
		,
			"11111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011100011000100110"
		,
			"111111110001001101111100010011011111000100110111111110001001101111100010011011111000100110111111110001001101111100010011011111010011100110"
	};

	vector<string> leftEthers = {
		"",
		"1111",
		"11111000",
		"111110001001",
		"11",
		"111110",
		"1111100010"
	};

	vector<string> rightEthers = {
		"",
		"1000100110",
		"100110",
		"10",
		"111000100110",
		"00100110",
		"0110"
	};

	string basePath = "D:/olbrl/Downloads/Collisions01Dephased/";

	for (int i = offset; i < maxDephase; i++) {
		for (int j = 0; j < g1elec2.size(); j++) {
			string ic = left + g1elec2[j] + mid + leftEthers[i % 7] + dephasedEca->getCurrentState()[0] + rightEthers[i % 7];

			createCollision(ic, numIterations, 1,
				basePath + "g_p" + std::to_string(i) + "_f" + std::to_string(j) + ".png",
				0);
		}

		dephasedEca->applyRule();
	}

	EXPECT_EQ(1, 1);
}


TEST(TestCTS0Dephased, Testing) {
	int offset = 0;
	int maxDephase = 200;
	int numIterations = 3000;

	int midEthers = 86;


	Rule110 r;

	string left = r.Translate("2e");

	string mid = r.Translate(std::to_string(midEthers) + "e");

	string right = r.Translate("e - 0Ele_C2(A, f3_1) - A3(A, f1_1) - SepInit_EE_(C, f3_1) - 1BloP_E_(C, f4_1) - SepInit_EE_(C,f3_1)");

	NaiveController* dephasedEca = new NaiveController(right.length(), 110, right);
	for (int i = 0; i < offset; i++) {
		dephasedEca->applyRule();
	}

	vector<string> p = {
		"11111011101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011101001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001110111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111101110"
		,
			"1111100011101110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111101110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001110111000100110"
		,
			"11101001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100011101110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110111011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101110100110"
	};

	vector<string> leftEthers = {
		"",
		"1111",
		"11111000",
		"111110001001",
		"11",
		"111110",
		"1111100010"
	};

	vector<string> rightEthers = {
		"",
		"1000100110",
		"100110",
		"10",
		"111000100110",
		"00100110",
		"0110"
	};

	string basePath = "D:/olbrl/Downloads/Collisions0Dephased/";

	for (int i = offset; i < maxDephase; i++) {
		for (int j = 0; j < p.size(); j++) {
			string ic = left + p[j] + mid + leftEthers[i % 7] + dephasedEca->getCurrentState()[0] + rightEthers[i % 7];

			createCollision(ic, numIterations, 1,
				basePath + "g_p" + std::to_string(i) + "_f" + std::to_string(j) + ".png",
				0);
		}

		dephasedEca->applyRule();
	}

	EXPECT_EQ(1, 1);
}



TEST(TestCustomEb, Testing) {
	int minEthers = 10;
	int maxEthers = 100;

	int offset = 250;
	int numIterations = 1500;

	Rule110 r;

	string left = r.Translate("2e");
	
	vector<string> g1elec2 = {
		"111110000001001101111100010011011111000100110111110000001001101111100010011011111000100110111110000001001101111100010011011111000111011010"
		,
			"111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111110001000001101111100010011011111000100110111"
		,
			"000111110001001101111100010011011111000100110000111110001001101111100010011011111000100110000111110001001101111100010011011111000000100110"
		,
			"111000110001001101111100010011011111000100110111000110001001101111100010011011111000100110111000110001001101111100010011011111000100000110"

		,
			"111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110111110100111001101111100010011011111000100110000"
		,
			"11111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011111000111011010111110001001101111100010011011100011000100110"
		,
			"111111110001001101111100010011011111000100110111111110001001101111100010011011111000100110111111110001001101111100010011011111010011100110"
	};


	vector<string> customEb = {
		"1111100011101100101101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110100011010011000100110",
		"11110111111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110011111011100110",
		"11111001110000010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001011000111010",
		"11111000101101000011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001111100110",
		"11111000100111111100011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101100010",
		"11000001001100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111111001111000100110",
		"11111100001101110011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110000101100100110",
		"11111000010001111101011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001000111110110",
		"11111000100011001100011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001100110001",
		"01110111001100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111011100110000100110",
		"11101101110101110011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110111010111000110",
		"11111011111101111101011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001110111110100",
		"1111100011100001110001111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111000111011000100110",
		"10001101001100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110100110111100110",
		"11111001111101110011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001110111110010",
		"1111100010110001110101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111000101111000100110",
		"1111100010011111001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110100111100100110",
		"11000101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001110110010110",
		"11111100111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111011",
		"1111100001011001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110011100000100110",
		"1111100010001111101101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001011010000110",
		"01100011111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001111111000",
		"1110111001100001001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110110000010011000100110",
		"1111101110101110001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111111000011011100110",
		"1111100011101111101001111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110000100011111010",
		"11100011101100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001000110011000",
		"1111101001101111001101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110011101110011000100110",
		"1111100011101111100101111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111011011101011100110",
		"11100010111100010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110111111011111010",
		"11111010011110010011011111000100110111110001001101111100010011011111000100110111110001001101111100010011011111000100110111110001110000111000"
	};

	string basePath = "D:/olbrl/Downloads/CollisionsCustomEb/";

	for (int i = minEthers; i < maxEthers; i++) {
		string cur = r.Translate(to_string(i) + "e");
		
		for (int j = 0; j < customEb.size(); j++) {
			for (int k = 0; k < g1elec2.size(); k++) {
				string ic = left + g1elec2[k] + cur + customEb[j];

				createCollision(ic, numIterations, 1,
					basePath + "g_" + std::to_string(i) + "e_Eb" + std::to_string(j) + "_ele" + std::to_string(k) + ".png",
					offset);
			}
		}
	}

	EXPECT_EQ(1, 1);
}


TEST(TestCookCTS, Testing) {
	int minEthers = 1;
	int maxEthers = 5;

	int offset = 10500;
	int numIterations = 3000;

	Rule110 r;

	string left = r.Translate("4_A4(F3) - 87e-4_A4(F2)-87e-4_A4(F1)-87e-4_A4(F3) -86e-1Ele_C2(A, f1_1) -A3(A, f1_1) -SepInit_EE_(C, f3_1) -1BloP_E_(C, f4_1) -1BloS_E_(c, f4_1) - 1BloS_E_(G, f4_1) - SepInit_EE_(H, f3_1) ");

	vector<string> p = {
"11111000010001111101011111000100110111110001001101111100001011001001101111100011101100101101111100010001100110001111100010011011111000100110111110111111011111010111110001001101111100010011011111000010001111101011111000100110111110001001100110001111110001001101111100010011011111000100110111110001011010000110111110011111011100110111011100110000100110111110001001101111100010011011100011101100010011011111000100110111110001001100110001",
"1111100010001100110001111100010011011111000100110111110001000111110110111110001001101111011111110001001100111011100110001001101111100010011011111000111000011100011111000100110111110001001101111100010001100110001111100010011011111000100110111011100110000100110111110001001101111100010011011111000100111111100011111000101100011101011111011101011100011011111000100110111110001001101111101001101111001101111100010011011111000100110111011100110000100110",
"01110111001100010011011111000100110111110001001100110001111110001001101111100111000001001101110110111010111001101111100010011011111000100110100011010011000100110111110001001101111100010011001110111001100010011011111000100110111110111010111000110111110001001101111100010011011111000100110110000010011000100111110011011111000111011111010011111000100110111110001001101111100011101111100101111100010011011111000100110111110111010111000110",
"11101101110101110011011111000100110111110001001101110111001100001001101111100010110100001101111101111110111110101111100010011011111000100110111110011111011100110111110001001101111100010011011101101110101110011011111000100110111110001110111110100111110001001101111100010011011111000100110111111000011011100110110001011111000100110111000111011000100110111110001001101111100010011011100010111100010011011111000100110111110001110111110100",
"1111101111110111110101111100010011011111000100110111110111010111000110111110001001111111000111110001110000111000111110001001101111100010011011111000101100011101011111000100110111110001001101111101111110111110101111100010011011111000100110111000111011000100110111110001001101111100010011011111000010001111101011111100111100010011011111010011011110011011111000100110111110001001101111101001111001001101111100010011011111000100110111000111011000100110",
"1111100011100001110001111100010011011111000100110111110001110111110100111110001001101100000100110001001101000110100110001001101111100010011011111000100111110011011111000100110111110001001101111100011100001110001111100010011011111000100110111110100110111100110111110001001101111100010011011111000100011001100011111000010110010011011111000111011111001011111000100110111110001001101111100011101100101101111100010011011111000100110111110100110111100110",
"10001101001100010011011111000100110111110001001101110001110110001001101111110000110111001101111100111110111001101111100010011011111000100110110001011111000100110111110001001101111100010011010001101001100010011011111000100110111110001110111110010111110001001101111100010011011111000100110011101110011000100011111011011111000100110111000101111000100110111110001001101111100010011011110111111100010011011111000100110111110001110111110010",
"1111100111110111001101111100010011011111000100110111110100110111100110111110000100011111010111110001011000111010111110001001101111100010011011111100111100010011011111000100110111110001001101111100111110111001101111100010011011111000100110111000101111000100110111110001001101111100010011011101101110101110011001100011111100010011011111010011110010011011111000100110111110001001101111100111000001001101111100010011011111000100110111000101111000100110",
"1111100010110001110101111100010011011111000100110111110001110111110010111110001000110011000111110001001111100110111110001001101111100010011011111000010110010011011111000100110111110001001101111100010110001110101111100010011011111000100110111110100111100100110111110001001101111100010011011111011111101111101011101110011000010011011111000111011001011011111000100110111110001001101111100010110100001101111100010011011111000100110111110100111100100110",
"1111100010011111001101111100010011011111000100110111110001001101110001011110001001100111011100110001001101100010111110001001101111100010011011111000100011111011011111000100110111110001001101111100010011111001101111100010011011111000100110111110001110110010110111110001001101111100010011011111000111000011100011111011101011100011011111000100110111101111111000100110111110001001101111100010011111110001111100010011011111000100110111110001110110010110",
"11000101111100010011011111000100110111110001001101111101001111001001101110110111010111001101111110011110001001101111100010011011111000100110011000111111000100110111110001001101111100010011011000101111100010011011111000100110111110001001101111011111110001001101111100010011011111000100110100011010011000111011111010011111000100110111110011100000100110111110001001101111100010011011000001001100010011011111000100110111110001001101111011",
"1111110011110001001101111100010011011111000100110111110001110110010110111110111111011111010111110000101100100110111110001001101111100010011011101110011000010011011111000100110111110001001101111110011110001001101111100010011011111000100110111110011100000100110111110001001101111100010011011111001111101110011011100011101100010011011111000101101000011011111000100110111110001001101111110000110111001101111100010011011111000100110111110011100000100110",
"1111100001011001001101111100010011011111000100110111110001001101111011111110001110000111000111110001000111110110111110001001101111100010011011111011101011100011011111000100110111110001001101111100001011001001101111100010011011111000100110111110001011010000110111110001001101111100010011011111000101100011101011111010011011110011011111000100111111100011111000100110111110001001101111100001000111110101111100010011011111000100110111110001011010000110",
"1111100010001111101101111100010011011111000100110111110001001101111100111000001001101000110100110001001100110001111110001001101111100010011011111000111011111010011111000100110111110001001101111100010001111101101111100010011011111000100110111110001001111111000111110001001101111100010011011111000100111110011011111000111011111001011111000100110110000010011000100110111110001001101111100010001100110001111100010011011111000100110111110001001111111000",
"0110001111110001001101111100010011011111000100110111110001011010000110111110011111011100110111011100110000100110111110001001101111100010011011100011101100010011011111000100110111110001001100110001111110001001101111100010011011111000100110110000010011000100110111110001001101111100010011011000101111100010011011100010111100010011011111100001101110011011111000100110111110001001100111011100110001001101111100010011011111000100110110000010011000100110",
"1110111001100001001101111100010011011111000100110111110001001111111000111110001011000111010111110111010111000110111110001001101111100010011011111010011011110011011111000100110111110001001101110111001100001001101111100010011011111000100110111111000011011100110111110001001101111100010011011111100111100010011011111010011110010011011111000010001111101011111000100110111110001001101110110111010111001101111100010011011111000100110111111000011011100110",
"1111101110101110001101111100010011011111000100110111110001001101100000100110001001111100110111110001110111110100111110001001101111100010011011111000111011111001011111000100110111110001001101111101110101110001101111100010011011111000100110111110000100011111010111110001001101111100010011011111000010110010011011111000111011001011011111000100011001100011111000100110111110001001101111101111110111110101111100010011011111000100110111110000100011111010",
"1111100011101111101001111100010011011111000100110111110001001101111110000110111001101100010111110001001101110001110110001001101111100010011011111000100110111000101111000100110111110001001101111100011101111101001111100010011011111000100110111110001000110011000111110001001101111100010011011111000100011111011011111000100110111101111111000100110011101110011000100110111110001001101111100011100001110001111100010011011111000100110111110001000110011000",
"1110001110110001001101111100010011011111000100110111110000100011111010111111001111000100110111110100110111100110111110001001101111100010011011111010011110010011011111000100110111110001001101110001110110001001101111100010011011111000100110011101110011000100110111110001001101111100010011001100011111100010011011111001110000010011011101101110101110011011111000100110111110001001101000110100110001001101111100010011011111000100110011101110011000100110",
"1111101001101111001101111100010011011111000100110111110001000110011000111110000101100100110111110001110111110010111110001001101111100010011011111000111011001011011111000100110111110001001101111101001101111001101111100010011011111000100110111011011101011100110111110001001101111100010011011101110011000010011011111000101101000011011111011111101111101011111000100110111110001001101111100111110111001101111100010011011111000100110111011011101011100110",
"1111100011101111100101111100010011011111000100110111110001001100111011100110001000111110110111110001001101110001011110001001101111100010011011111000100110111101111111000100110111110001001101111100011101111100101111100010011011111000100110111110111111011111010111110001001101111100010011011111011101011100011011111000100111111100011111000111000011100011111000100110111110001001101111100010110001110101111100010011011111000100110111110111111011111010",
"11100010111100010011011111000100110111110001001101110110111010111001100110001111110001001101111101001111001001101111100010011011111000100110111110011100000100110111110001001101111100010011011100010111100010011011111000100110111110001110000111000111110001001101111100010011011111000111011111010011111000100110110000010011000100110100011010011000100110111110001001101111100010011111001101111100010011011111000100110111110001110000111000",
"1111101001111001001101111100010011011111000100110111110111111011111010111011100110000100110111110001110110010110111110001001101111100010011011111000101101000011011111000100110111110001001101111101001111001001101111100010011011111000100110100011010011000100110111110001001101111100010011011100011101100010011011111100001101110011011111001111101110011011111000100110111110001001101100010111110001001101111100010011011111000100110100011010011000100110",
"1111100011101100101101111100010011011111000100110111110001110000111000111110111010111000110111110001001101111011111110001001101111100010011011111000100111111100011111000100110111110001001101111100011101100101101111100010011011111000100110111110011111011100110111110001001101111100010011011111010011011110011011111000010001111101011111000101100011101011111000100110111110001001101111110011110001001101111100010011011111000100110111110011111011100110",
"11110111111100010011011111000100110111110001001101000110100110001110111110100111110001001101111100111000001001101111100010011011111000100110110000010011000100110111110001001101111100010011011110111111100010011011111000100110111110001011000111010111110001001101111100010011011111000111011111001011111000100011001100011111000100111110011011111000100110111110001001101111100001011001001101111100010011011111000100110111110001011000111010",
"11111001110000010011011111000100110111110001001101111100111110111001101110001110110001001101111100010110100001101111100010011011111000100110111111000011011100110111110001001101111100010011011111001110000010011011111000100110111110001001111100110111110001001101111100010011011111000100110111000101111000100110011101110011000100110110001011111000100110111110001001101111100010001111101101111100010011011111000100110111110001001111100110",
"11111000101101000011011111000100110111110001001101111100010110001110101111101001101111001101111100010011111110001111100010011011111000100110111110000100011111010111110001001101111100010011011111000101101000011011111000100110111110001001101100010111110001001101111100010011011111000100110111110100111100100110111011011101011100110111111001111000100110111110001001101111100010011001100011111100010011011111000100110111110001001101100010",
"1111100010011111110001111100010011011111000100110111110001001111100110111110001110111110010111110001001101100000100110001001101111100010011011111000100011001100011111000100110111110001001101111100010011111110001111100010011011111000100110111111001111000100110111110001001101111100010011011111000111011001011011111011111101111101011111000010110010011011111000100110111110001001101110111001100001001101111100010011011111000100110111111001111000100110",
"11000001001100010011011111000100110111110001001101100010111110001001101110001011110001001101111110000110111001101111100010011011111000100110011101110011000100110111110001001101111100010011011000001001100010011011111000100110111110000101100100110111110001001101111100010011011111000100110111101111111000111000011100011111000100011111011011111000100110111110001001101111101110101110001101111100010011011111000100110111110000101100100110",
"11111100001101110011011111000100110111110001001101111110011110001001101111101001111001001101111100001000111110101111100010011011111000100110111011011101011100110111110001001101111100010011011111100001101110011011111000100110111110001000111110110111110001001101111100010011011111000100110111110011100000100110100011010011000100110011000111111000100110111110001001101111100011101111101001111100010011011111000100110111110001000111110110"
	};

	string basePath = "D:/olbrl/Downloads/CollisionsCookCTS/";

	for (int i = minEthers; i < maxEthers; i++) {
		for (int j = 0; j < p.size(); j++) {
			string cur = i == 0 ? "" : (to_string(i) + "e");
			string ic = left + r.Translate(cur) + p[j];

			createCollision(ic, numIterations, 1,
				basePath + "g_" + std::to_string(i) + "e_f" + std::to_string(j) + ".png",
				offset);
		}
	}

	EXPECT_EQ(1, 1);
}


TEST(TestAs, Testing) {
	Rule110 r;

	string ic = r.Translate("e-eb(a,f1)-e");

	NaiveController* eca = new NaiveController(ic.length(), 110, ic);
	ofstream leftFile("D:/olbrl/Downloads/testEbs.txt");

	for (int i = 0; i < 10000; i++) {
		string s = eca->getCurrentState()[0];
		if (i % 7 == 0 && s.rfind("11111000100110", 0) == 0) {
			leftFile << "Found " << s << endl;
		}
		else {
			leftFile << s << endl;
		}
		eca->applyRule();
	}
	
	leftFile.close();

	EXPECT_EQ(1, 1);
}


TEST(WolframCTS, Testing) {
	int minEthers = 0;
	int maxEthers = 5;

	int minPaint = 0;
	int maxPaint = -1;

	int offset = 49500;

	int numIterations = 4000;

	
	Rule110 r;
	
	string left = r.Translate("4_A4(F1)-87e-4_A4(F3)-87e-4_A4(F2)-87e-4_A4(F1)-44e-87e-4_A4(F3) -86e-87e -4_A4(F2) -87e -4_A4(F1) -87e -4_A4(F3) -87e - 4_A4(F2) -44e -86e -86e -86e -87e -4_A4(F1) -87e -4_A4(F3) -87e -4_A4(F2) -87e -4_A4(F1) -87e -4_A4(F3) -86e -1Ele_C2(A, f1_1) -A3(A, f1_1) -SepInit_EE_(C, f3_1) -1BloP_E_(C, f4_1) -SepInit_EE_(C, f3_1) -1BloP_E_(C, f4_1) -0Blo_E_(C, f4_1) -1BloS_E_(A, f4_1) -SepInit_EE_(A, f2_1) -1BloP_E_(F, f1_1) -SepInit_EE_(A, f2_1) -1BloP_E_(F, f1_1) -0Blo_E_(E, f4_1) -1BloS_E_(C, f4_1) -SepInit_EE_(B, f1_1) -1BloP_E_(F, f3_1) -SepInit_EE_(B, f1_1)-1BloP_E_(F, f3_1)-0Blo_E_(F, f3_1)-1BloS_E_(D, f2_1)-SepInit_EE_(H, f1_1)-1BloP_E_(E,f3_1)-SepInit_EE_(H, f4_1)-1BloP_E_(E,f3_1)-0Blo_E_(E, f2_1)-1BloS_E_(C, f2_1)-SepInit_EE_(C,f1_1)-1BloP_E_(A,f3_1)");

	minPaint = (left.length() + 450 + (maxEthers * 14)) * 0.66;
	maxPaint = (left.length() + 450 + (maxEthers * 14)) * 0.78;

	vector<string> p = {
"111110000100011111010111110001001101000110100110001001101111100010011011111001111101110011011101110011000010011011111000100110111110001001101110001110110001001101111100010011011111000100110011000111111000100110111110100111100100110111110001001101111100010011011111011111101111101011101110011000010011011111000111011001011011111000100110111110001001101111100010110100001101111100010011011111000100110111110100111100100110",
"111110001000110011000111110001001101111100111110111001101111100010011011111000101100011101011111011101011100011011111000100110111110001001101111101001101111001101111100010011011111000100110111011100110000100110111110001110110010110111110001001101111100010011011111000111000011100011111011101011100011011111000100110111101111111000100110111110001001101111100010011111110001111100010011011111000100110111110001110110010110",
"0111011100110001001101111100010110001110101111100010011011111000100111110011011111000111011111010011111000100110111110001001101111100011101111100101111100010011011111000100110111110111010111000110111110001001101111011111110001001101111100010011011111000100110100011010011000111011111010011111000100110111110011100000100110111110001001101111100010011011000001001100010011011111000100110111110001001101111011",
"111011011101011100110111110001001111100110111110001001101111100010011011000101111100010011011100011101100010011011111000100110111110001001101110001011110001001101111100010011011111000111011111010011111000100110111110011100000100110111110001001101111100010011011111001111101110011011100011101100010011011111000101101000011011111000100110111110001001101111110000110111001101111100010011011111000100110111110011100000100110",
"111110111111011111010111110001001101100010111110001001101111100010011011111100111100010011011111010011011110011011111000100110111110001001101111101001111001001101111100010011011111000100110111000111011000100110111110001011010000110111110001001101111100010011011111000101100011101011111010011011110011011111000100111111100011111000100110111110001001101111100001000111110101111100010011011111000100110111110001011010000110",
"111110001110000111000111110001001101111110011110001001101111100010011011111000010110010011011111000111011111001011111000100110111110001001101111100011101100101101111100010011011111000100110111110100110111100110111110001001111111000111110001001101111100010011011111000100111110011011111000111011111001011111000100110110000010011000100110111110001001101111100010001100110001111100010011011111000100110111110001001111111000",
"100011010011000100110111110000101100100110111110001001101111100010001111101101111100010011011100010111100010011011111000100110111110001001101111011111110001001101111100010011011111000111011111001011111000100110110000010011000100110111110001001101111100010011011000101111100010011011100010111100010011011111100001101110011011111000100110111110001001100111011100110001001101111100010011011111000100110110000010011000100110",
"111110011111011100110111110001000111110110111110001001101111100010011001100011111100010011011111010011110010011011111000100110111110001001101111100111000001001101111100010011011111000100110111000101111000100110111111000011011100110111110001001101111100010011011111100111100010011011111010011110010011011111000010001111101011111000100110111110001001101110110111010111001101111100010011011111000100110111111000011011100110",
"111110001011000111010111110001001100110001111110001001101111100010011011101110011000010011011111000111011001011011111000100110111110001001101111100010110100001101111100010011011111000100110111110100111100100110111110000100011111010111110001001101111100010011011111000010110010011011111000111011001011011111000100011001100011111000100110111110001001101111101111110111110101111100010011011111000100110111110000100011111010",
"111110001001111100110111110001001101110111001100001001101111100010011011111011101011100011011111000100110111101111111000100110111110001001101111100010011111110001111100010011011111000100110111110001110110010110111110001000110011000111110001001101111100010011011111000100011111011011111000100110111101111111000100110011101110011000100110111110001001101111100011100001110001111100010011011111000100110111110001000110011000",
"110001011111000100110111110111010111000110111110001001101111100011101111101001111100010011011111001110000010011011111000100110111110001001101100000100110001001101111100010011011111000100110111101111111000100110011101110011000100110111110001001101111100010011001100011111100010011011111001110000010011011101101110101110011011111000100110111110001001101000110100110001001101111100010011011111000100110011101110011000100110",
"111111001111000100110111110001110111110100111110001001101111100010011011100011101100010011011111000101101000011011111000100110111110001001101111110000110111001101111100010011011111000100110111110011100000100110111011011101011100110111110001001101111100010011011101110011000010011011111000101101000011011111011111101111101011111000100110111110001001101111100111110111001101111100010011011111000100110111011011101011100110",
"111110000101100100110111110001001101110001110110001001101111100010011011111010011011110011011111000100111111100011111000100110111110001001101111100001000111110101111100010011011111000100110111110001011010000110111110111111011111010111110001001101111100010011011111011101011100011011111000100111111100011111000111000011100011111000100110111110001001101111100010110001110101111100010011011111000100110111110111111011111010",
"111110001000111110110111110001001101111101001101111001101111100010011011111000111011111001011111000100110110000010011000100110111110001001101111100010001100110001111100010011011111000100110111110001001111111000111110001110000111000111110001001101111100010011011111000111011111010011111000100110110000010011000100110100011010011000100110111110001001101111100010011111001101111100010011011111000100110111110001110000111000",
"011000111111000100110111110001110111110010111110001001101111100010011011100010111100010011011111100001101110011011111000100110111110001001100111011100110001001101111100010011011111000100110110000010011000100110100011010011000100110111110001001101111100010011011100011101100010011011111100001101110011011111001111101110011011111000100110111110001001101100010111110001001101111100010011011111000100110100011010011000100110",
"111011100110000100110111110001001101110001011110001001101111100010011011111010011110010011011111000010001111101011111000100110111110001001101110110111010111001101111100010011011111000100110111111000011011100110111110011111011100110111110001001101111100010011011111010011011110011011111000010001111101011111000101100011101011111000100110111110001001101111110011110001001101111100010011011111000100110111110011111011100110",
"111110111010111000110111110001001101111101001111001001101111100010011011111000111011001011011111000100011001100011111000100110111110001001101111101111110111110101111100010011011111000100110111110000100011111010111110001011000111010111110001001101111100010011011111000111011111001011111000100011001100011111000100111110011011111000100110111110001001101111100001011001001101111100010011011111000100110111110001011000111010",
"111110001110111110100111110001001101111100011101100101101111100010011011111000100110111101111111000100110011101110011000100110111110001001101111100011100001110001111100010011011111000100110111110001000110011000111110001001111100110111110001001101111100010011011111000100110111000101111000100110011101110011000100110110001011111000100110111110001001101111100010001111101101111100010011011111000100110111110001001111100110",
"1110001110110001001101111100010011011110111111100010011011111000100110111110011100000100110111011011101011100110111110001001101111100010011010001101001100010011011111000100110111110001001100111011100110001001101100010111110001001101111100010011011111000100110111110100111100100110111011011101011100110111111001111000100110111110001001101111100010011001100011111100010011011111000100110111110001001101100010",
"111110100110111100110111110001001101111100111000001001101111100010011011111000101101000011011111011111101111101011111000100110111110001001101111100111110111001101111100010011011111000100110111011011101011100110111111001111000100110111110001001101111100010011011111000111011001011011111011111101111101011111000010110010011011111000100110111110001001101110111001100001001101111100010011011111000100110111111001111000100110",
"111110001110111110010111110001001101111100010110100001101111100010011011111000100111111100011111000111000011100011111000100110111110001001101111100010110001110101111100010011011111000100110111110111111011111010111110000101100100110111110001001101111100010011011111000100110111101111111000111000011100011111000100011111011011111000100110111110001001101111101110101110001101111100010011011111000100110111110000101100100110",
"1110001011110001001101111100010011111110001111100010011011111000100110110000010011000100110100011010011000100110111110001001101111100010011111001101111100010011011111000100110111110001110000111000111110001000111110110111110001001101111100010011011111000100110111110011100000100110100011010011000100110011000111111000100110111110001001101111100011101111101001111100010011011111000100110111110001000111110110",
"1111101001111001001101111100010011011000001001100010011011111000100110111111000011011100110111110011111011100110111110001001101111100010011011000101111100010011011111000100110111110001001101000110100110001001100110001111110001001101111100010011011111000100110111110001011010000110111110011111011100110111011100110000100110111110001001101111100010011011100011101100010011011111000100110111110001001100110001",
"111110001110110010110111110001001101111110000110111001101111100010011011111000010001111101011111000101100011101011111000100110111110001001101111110011110001001101111100010011011111000100110111110011111011100110111011100110000100110111110001001101111100010011011111000100111111100011111000101100011101011111011101011100011011111000100110111110001001101111101001101111001101111100010011011111000100110111011100110000100110",
"1111011111110001001101111100001000111110101111100010011011111000100011001100011111000100111110011011111000100110111110001001101111100001011001001101111100010011011111000100110111110001011000111010111110111010111000110111110001001101111100010011011111000100110110000010011000100111110011011111000111011111010011111000100110111110001001101111100011101111100101111100010011011111000100110111110111010111000110",
"1111100111000001001101111100010001100110001111100010011011111000100110011101110011000100110110001011111000100110111110001001101111100010001111101101111100010011011111000100110111110001001111100110111110001110111110100111110001001101111100010011011111000100110111111000011011100110110001011111000100110111000111011000100110111110001001101111100010011011100010111100010011011111000100110111110001110111110100",
"111110001011010000110111110001001100111011100110001001101111100010011011101101110101110011011111100111100010011011111000100110111110001001100110001111110001001101111100010011011111000100110110001011111000100110111000111011000100110111110001001101111100010011011111000010001111101011111100111100010011011111010011011110011011111000100110111110001001101111101001111001001101111100010011011111000100110111000111011000100110",
"111110001001111111000111110001001101110110111010111001101111100010011011111011111101111101011111000010110010011011111000100110111110001001101110111001100001001101111100010011011111000100110111111001111000100110111110100110111100110111110001001101111100010011011111000100011001100011111000010110010011011111000111011111001011111000100110111110001001101111100011101100101101111100010011011111000100110111110100110111100110",
"1100000100110001001101111101111110111110101111100010011011111000111000011100011111000100011111011011111000100110111110001001101111101110101110001101111100010011011111000100110111110000101100100110111110001110111110010111110001001101111100010011011111000100110011101110011000100011111011011111000100110111000101111000100110111110001001101111100010011011110111111100010011011111000100110111110001110111110010",
"111111000011011100110111110001110000111000111110001001101111100010011010001101001100010011001100011111100010011011111000100110111110001110111110100111110001001101111100010011011111000100011111011011111000100110111000101111000100110111110001001101111100010011011101101110101110011001100011111100010011011111010011110010011011111000100110111110001001101111100111000001001101111100010011011111000100110111000101111000100110"};

	string basePath = "D:/olbrl/Downloads/WolframCollider7/Collisions/";

	for (int i = minEthers; i < maxEthers; i++) {
		for (int j = 0; j < p.size(); j++) {
			string cur = i == 0 ? "" : (to_string(i) + "e");
			string ic = left + r.Translate(cur) + p[j];

			createCollision(ic, numIterations, 1,
				basePath + "g_" + std::to_string(i) + "e_f" + std::to_string(j) + ".png",
				offset, minPaint, maxPaint);
		}
	}

	EXPECT_EQ(1, 1);
}

TEST(PrintWolframGrid, Testing) {
	int offset = 0;
	int maxGridSize = 54000;
	int numIterations = 2000;

	

	Rule110 r;

	string ic = r.Translate("4_A4(F3)-87e-4_A4(F2)-87e-4_A4(F1)-44e-87e-4_A4(F3) -86e-87e -4_A4(F2) -87e -4_A4(F1) -87e -4_A4(F3) -87e - 4_A4(F2) -44e -86e -86e -86e -87e -4_A4(F1) -87e -4_A4(F3) -87e -4_A4(F2) -87e -4_A4(F1) -87e -4_A4(F3) -86e -1Ele_C2(A, f1_1) -A3(A, f1_1) -SepInit_EE_(C, f3_1) -1BloP_E_(C, f4_1) -SepInit_EE_(C, f3_1) -1BloP_E_(C, f4_1) -0Blo_E_(C, f4_1) -1BloS_E_(A, f4_1) -SepInit_EE_(A, f2_1) -1BloP_E_(F, f1_1) -SepInit_EE_(A, f2_1) -1BloP_E_(F, f1_1) -0Blo_E_(E, f4_1) -1BloS_E_(C, f4_1) -SepInit_EE_(B, f1_1) -1BloP_E_(F, f3_1) -SepInit_EE_(B, f1_1)-1BloP_E_(F, f3_1)-0Blo_E_(F, f3_1)-1BloS_E_(D, f2_1)-SepInit_EE_(H, f1_1)-1BloP_E_(E,f3_1)-SepInit_EE_(H, f4_1)-1BloP_E_(E,f3_1)-0Blo_E_(E, f2_1)-1BloS_E_(C, f2_1)-SepInit_EE_(C,f1_1)-1BloP_E_(A,f3_1)");
	
	string basePath = "D:/olbrl/Downloads/WolframCollider7/Grid/White";

	createGrid(ic, numIterations, maxGridSize, 1, basePath, offset);

	EXPECT_EQ(1, 1);
}


TEST(GetWolframIC, Testing) {
	int offset = 0;
	int maxGridSize = 54000;
	int numIterations = 2000;

	string ic[] = {
"4_A4(F3)",
"87e",
"4_A4(F2)",
"87e",
"4_A4(F1)",
"87e",
"4_A4(F3)",
"86e",
"87e",
"4_A4(F2)",
"87e",
"4_A4(F1)",
"87e",
"4_A4(F3)",
"87e",
"4_A4(F2)",
"44e",
"86e",
"86e",
"86e",
"87e",
"4_A4(F1)",
"87e",
"4_A4(F3)",
"87e",
"4_A4(F2)",
"87e",
"4_A4(F1)",
"87e",
"4_A4(F3)",
"86e",
		"",
"1Ele_C2(A,f1_1)",
		"",
"A3(A,f1_1)",
"SepInit_EE_(C,f3_1)",
"1BloP_E_(C,f4_1)",
"SepInit_EE_(C,f3_1)",
"1BloP_E_(C,f4_1)",
"0Blo_E_(C,f4_1)",
"1BloS_E_(A,f4_1)",
"SepInit_EE_(A,f2_1)",
"1BloP_E_(F,f1_1)",
"SepInit_EE_(A,f2_1)",
"1BloP_E_(F,f1_1)",
"0Blo_E_(E,f4_1)",
"1BloS_E_(C,f4_1)",
"SepInit_EE_(B,f1_1)",
"1BloP_E_(F,f3_1)",
"SepInit_EE_(B,f1_1)",
"1BloP_E_(F,f3_1)",
"0Blo_E_(F,f3_1)",
"1BloS_E_(D,f2_1)",
"SepInit_EE_(H,f1_1)",
"1BloP_E_(E,f3_1)",
"SepInit_EE_(H,f4_1)",
"1BloP_E_(E,f3_1)",
"0Blo_E_(E,f2_1)",
"1BloS_E_(C,f2_1)",
"SepInit_EE_(C,f1_1)",
"1BloP_E_(A,f3_1)"
	};

	ofstream file("D:/olbrl/Downloads/WolframCollider7/Grid/ic.txt");
	Rule110 r;

	for(string& s : ic) {
		file << r.Translate(s) << endl;
	}
	
	EXPECT_EQ(1, 1);
}

